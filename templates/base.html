<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!--Tell the browser to be responsive to screen width-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <!--Favicon icon-->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='Logo1.png') }}">

    <title>Causal Stock Trading</title>

    <link href="{{ url_for('static', filename='owl.carousel.min.css') }}" rel="stylesheet"/>
    <link href="{{ url_for('static', filename='owl.theme.default.min.css') }}" rel="stylesheet"/>

    <!--Bootstrap Core css-->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">

    <!--Custom css-->
    <link href="{{ url_for('static', filename='helper.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='style-RES.css') }}" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:** -->
    <!--[if lt IE 9]>
    <script src="https:**oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https:**oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
    <style>
        .diagram-chart img {
            max-width: 100%; /* Ensure the image fits within its container */
            height: auto; /* Maintain aspect ratio */
            visibility: visible; /* Ensure the image is visible */
        }
    </style>

    <style>
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
    </style>

</head>

<body class="header-fix fix-sidebar">

    <!--Main Wrapper-->
    <div id="main-wrapper">
        <!--header header-->
        <div class="header">
            <nav class="navbar top-navbar navbar-expand-md navbar-light">

                <!--logo-->
                <div class="navbar-header">
                    <a href="http://localhost/www/wordpress-5.6.2/wordpress/" class="menuzord-brand"><img src="{{url_for('static', filename='Logo2.png')}}" ></a>
                </div>
                <!--End logo-->

                <div class="navbar-collapse">
                    <!-- toggle and nav items -->
                    <ul class="navbar-nav mr-auto mt-md-0">
                        <!-- This is  -->
                        <li class="nav-item"> <a class="nav-link toggle-nav hidden-md-up text-muted  " href="javascript:void(0)"><i class="mdi mdi-menu"></i></a> </li>
                        <li class="nav-item m-l-10"> <a class="nav-link sidebartoggle hidden-sm-down text-muted  " href="javascript:void(0)"><i class="ti-menu"></i></a> </li>
                        
                    </ul>
                </div>
            </nav>
        </div>
        <!-- End header header -->

        <!-- Left Sidebar  -->
        <div class="left-sidebar">
            <!--sidebar scroll-->
            <div class="scroll-sidebar">
                <!--sidebar navigation-->
                <nav class="sidebar-nav">
                    <ul id="sidebar-menu">
                        <li class="nav-devider"></li>
                        <br>
                        <li class="nav-label"><a href="http://localhost:5000/dashboard">PREDICT FUTURE STOCK</a></li>
                        <li class="nav-label"><a href="http://localhost:5000/dashboard">SENTIMENT ANALYSIS</a></li>
                        <li class="nav-label"><a href="http://localhost:5000/dashboard">CAUSAL AI</a></li>
                        <li class="nav-label"><a href="http://localhost:5000/dashboard">REAL-TIME STOCK</a></li>
                    </ul>
                </nav>
                <!-- End Sidebar navigation -->
            </div>
            <!-- End Sidebar scroll-->
        </div>
        <!-- End Left Sidebar  -->

        <!-- Page wrapper  -->
        <div class="page-wrapper">
            <!--bread crumb-->
            <div class="row page-titles">
                <!--Search Bar-->
                <div class="col-md-12 d-flex justify-content-center">
                    <form class="form-inline my-2 my-lg-0">
                        <input class="form-control mr-sm-2" type="search" id="callinsertintotable" placeholder="Search for stock symbol" aria-label="Search">
                        <button class="btn btn-blue my-2 my-sm-0" type="button" id="submitBtn">Search</button>
                    </form>
                </div>
                <!--End Search Bar-->

                <div class="col-md-5 align-self-center">
                    <h3 class="text-primary" id="today-stock-data">TODAY'S {{quote}} STOCK DATA</h3>
                </div>
                <div class="col-md-7 align-self-center">

                </div>
            </div>
            <!-- End Bread crumb -->
            <!-- Container fluid  -->
            <div class="container-fluid">
                <!--start page content-->
                <div class="row">
                    <div class="col-md-2">
                        <div class="card bg-primary p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-bag f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="open-value">{{open}}</h2>
                                    <p class="m-b-0 text-white">OPEN</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="card bg-warning p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-comment f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="high-value">{{high}}</h2>
                                    <p class="m-b-0 text-white">HIGH</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="card bg-success p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-vector f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="low-value">{{low}}</h2>
                                    <p class="m-b-0 text-white">LOW</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="card bg-danger p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-location-pin f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="close-value">{{close}}</h2>
                                    <p class="m-b-0 text-white">CLOSE</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="card bg-warning p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-comment f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="adj-close-value">{{adj_close}}</h2>
                                    <p class="m-b-0 text-white">ADJ CLOSE</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="card bg-primary p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-bag f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="volume-value">{{volume}}</h2>
                                    <p class="m-b-0 text-white">VOLUME</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="progress" style="display:none;" id="loadingProgressBar">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
                    </div>
                </div>
                

                <div class="row">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-title">
                                <h4>RECENT TRENDS IN {{quote}} STOCK PRICES</h4>
                            </div>
                            <div class="sales-chart" id="plotly-trend-graph-container">
                                
                            </div>
                        </div>
                        <!--/# card-->
                    </div>
                    <!--/# column-->

                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-title">
                                <h4>ARIMA MODEL PREDICTION</h4>
                            </div>
                            <div class="sales-chart" id="plotly-arima-graph-container">
                                
                            </div>
                        </div>
                        <!--/# card-->
                    </div>
                    <!--/# column-->

                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-title">
                                <h4>LSTM MODEL PREDICTION</h4>
                            </div>
                            <div class="team-chart" id="plotly-lstm-graph-container">
                                
                            </div>
                        </div>
                        <!--/# card-->
                    </div>
                    <!--/# column-->

                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-title">
                                <h4>LINEAR REGRESSION MODEL PREDICTION</h4>
                            </div>
                            <div class="team-chart" id="plotly-lr-graph-container">
                                
                            </div>
                        </div>
                        <!--/# card-->
                    </div>
                    <!--/# column-->
                    
                    
                      

                    <!--Arima pred-->
                    <div class="col-md-4">
                        <div class="card bg-success p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-vector f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="arima-pred">{{arima_pred}}</h2>
                                    <p class="m-b-0 text-white" id="arima-text">TOMORROW'S {{quote}} CLOSING PRICE BY ARIMA</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--LSTM pred-->
                    <div class="col-md-4">
                        <div class="card bg-warning p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-comment f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="lstm-pred">{{lstm_pred}}</h2>
                                    <p class="m-b-0 text-white" id="lstm-text">TOMORROW'S {{quote}} CLOSING PRICE BY LSTM</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--LR pred-->
                    <div class="col-md-4">
                        <div class="card bg-danger p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-location f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="lr-pred">{{lr_pred}}</h2>
                                    <p class="m-b-0 text-white" id="lr-text">TOMORROW'S {{quote}} CLOSING PRICE BY LINEAR REGRESSION</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--ARIMA ERR-->
                    <div class="col-md-4">
                        <div class="card bg-primary p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-vector f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="error-arima">{{error_arima}}</h2>
                                    <p class="m-b-0 text-white">ARIMA RMSE</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--LSTM ERR-->
                    <div class="col-md-4">
                        <div class="card bg-primary p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-comment f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="error-lstm">{{error_lstm}}</h2>
                                    <p class="m-b-0 text-white">LSTM RMSE</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--LR ERR-->
                    <div class="col-md-4">
                        <div class="card bg-primary p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-location-pin f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="error-lr">{{error_lr}}</h2>
                                    <p class="m-b-0 text-white">LINEAR REGRESSION RMSE</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--arima mae-->
                    <div class="col-md-4">
                        <div class="card bg-primary p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-vector f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="mae-arima">{{mae_arima}}</h2>
                                    <p class="m-b-0 text-white">ARIMA MAE</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--LSTM mae-->
                    <div class="col-md-4">
                        <div class="card bg-primary p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-comment f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="mae-lstm">{{mae_lstm}}</h2>
                                    <p class="m-b-0 text-white">LSTM MAE</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--LR mae-->
                    <div class="col-md-4">
                        <div class="card bg-primary p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-location-pin f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="mae-lr">{{mae_lr}}</h2>
                                    <p class="m-b-0 text-white">LINEAR REGRESSION MAE</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--End Row-->

                <!--7 days prediction-->
                <!--7 days prediction with arima-->
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-title" id="arima-pred-text">
                                <h4>PREDICTED {{ quote }} PRICE FOR THE NEXT 7 DAYS WITH ARIMA</h4>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table" id="arima-forecast">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Close</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!--7 days prediction with LSTM-->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-title" id="lstm-pred-text">
                                <h4>PREDICTED {{ lstm_pred }} PRICE FOR THE NEXT 7 DAYS WITH LSTM</h4>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table" id="lstm-forecast">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Close</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--7 days prediction with LR-->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-title" id="lr-pred-text">
                                <h4>PREDICTED {{ quote }} PRICE FOR THE NEXT 7 DAYS WITH LINEAR REGRESSION</h4>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table" id="lr-forecast">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>Close</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- /#column news sentiment -->
                    <div class="col-ig-12">
                        <div class="card">
                            <div class="card-title">
                                <h4>RECENT NEWS ABOUT {{quote}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>News</th>
                                                <th></th>
                                                <th></th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody id="news-headlines">
                                            <tr>
                                                <td>
                                                    <div class="round-img">
                                                        <a href="https://finviz.com/quote.ashx?t="><img style="padding: 0px,0px,0px,0px;width:70px;height: 70px;" src="{{url_for('static', filename='twitter-logo.png')}}" alt=""></a>
                                                    </div>
                                                </td>
                                                <td>{% for i in range(0,12) %}
                                            {{news_headlines[i]}}<br>
                                            {% endfor %}</td>
                                                <td><span></span></td>
                                                <td><span></span></td>
                                                <td><span class="badge badge-success"></span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-title">
                                <h4>SENTIMENT ANALYSIS FOR {{quote}} NEWS</h4>
                            </div>
                            <div class="sales-chart" id="plotly-sentiment-graph-container">
                                
                            </div>
                        </div>
                    </div>

                    <!-- OVERALL POLARITY -->
                    <div class="col-md-4">
                        <div class="card bg-success p-20">
                            <div class="media widget-ten">
                                <div class="media-left media media-middle">
                                    <span><i class="ti-location-pin f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="polarity">{{polarity}}</h2>
                                    <p class="m-b-0 text-white">OVERALL NEWS POLARITY ACCORDING TO THE SENTIMENT ANALYSIS</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <div class="card bg-primary p-20">
                            <div class="media widget-ten">  
                                <div class="media-left media media-middle">
                                    <span><i class="ti-comment f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="idea-decision" style="text-align: left;">According to the ML Predictions & Sentiment Analysis of the Tweets, a {{idea}} in {{quote}} stock is expected => {{decision}}</h2>
                                    <p class="m-b-0 text-white">RECOMMENDATION</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /#end column news sentiment -->
                </div>
                <!-- /# end row -->

                <!--Causal AI-->
                <!--Granger Causality Matrix-->
                <div class="row">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-title" id="causal-text">
                                <h4>Granger Causality Matrix OF {{quote}} STOCK</h4>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <div class="granger_causation_matrix">
                                                        {{ granger_results_html|safe }}
                                                    </div>
                                                </td>
                                                <td><span></span></td>
                                                <td><span></span></td>
                                                <td><span class="badge badge-success"></span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /# end row -->

            <div class="row">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-title">
                            <h4>DOWHY CAUSAL MODEL DIAGRAM SHOWING CAUSAL RELATIONSHIPS BETWEEN INDICATORS</h4>
                        </div>
                        <div class="diagram-chart">
                            <!-- <img id="causal-model-image" src="{{ url_for('static', filename='causal_model.png') }}"/> -->
                            <img id="causal-model-image" src=""/>
                        </div>
                    </div>
                    <!-- /# end card -->
                </div>
                <!-- /# end column -->
            </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card bg-success p-20">
                            <div class="media widget-ten">
                                <div class="media-left meida media-middle">
                                    <span><i class="ti-location-pin f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right">
                                    <h2 class="color-white text-white" id="causal-estimate-regression">Causal effect estimate (linear regression): {{causal_estimate_regression}}</h2>
                                    <p class="m-b-0 text-white" id="causal-estimate-regression-p">Explanation: This estimate suggests that, according to the linear regression method, the treatment (<strong>[RSI]</strong>) has a <strong>{{causal_estimate_regression_pos_neg}}</strong> causal effect on the outcome (<strong>[CLOSE]</strong>). Specifically, a one-unit increase in <strong>[RSI]</strong> is associated with an average <strong>{{causal_estimate_regression_increase_decrease}}</strong> of approximately <strong>{{causal_estimate_regression}}</strong> units in <strong>[CLOSE]</strong>, holding other common causes constant.</p>
                                </div>
                            </div>
                        </div>
                    </div>

            
                <div class="row">
                    <div class="col-md-6">
                        <div class="card bg-success p-20">
                            <div class="media widget-ten">
                                <div class="media-left meida media-middle">
                                    <span><i class="ti-location-pin f-s-40"></i></span>
                                </div>
                                <div class="media-body media-text-right causal_results">
                                    <h2 class="color-white text-white" id="causal-estimate-iv">Causal effect estimate (instrumental variable): {{causal_estimate_iv}}</h2>
                                    <p class="m-b-0 text-white" id="causal-estimate-iv-p">Explanation: This estimate, derived from the instrumental variable method, indicates that the treatment (<strong>[RSI]</strong>) has a <strong>{{causal_estimate_iv_pos_neg}}</strong> causal effect on the outcome (<strong>[CLOSE]</strong>). Here, a one-unit increase in <strong>[RSI]</strong> is associated with an average <strong>{{causal_estimate_iv_increase_decrease}}</strong> of approximately <strong>{{causal_estimate_iv}}</strong> units in <strong>[CLOSE]</strong>, when using <strong>[VOLUME]</strong> as an instrument.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- /# end row -->

                <!-- End PAge Content -->

            </div>
            <!-- End container fluid  -->

            <!--footer-->
            <div class="footer-section-area padding-top-bottom">
                <div class="container" style="background-color: #1f2b31;">
                    <div class="row">

                        <div class="col-lg-12"><img  src="{{url_for('static', filename='Logo2.png')}}" />
                            <p style="color:white;">JKS was started with a common goal of serving the finance community while they make transitions. All our team members bring to table their unique expertise and experience of stock market which they would like to pass on to future investors.</p>
                        </div>

                        <div class="col-lg-12">
                            <div class="information">
                                <ul>
                                    <li><a style="color:white;padding-top: 10px;" href="http://localhost/www/wordpress-5.6.2/wordpress/"> <i class="fa fa-arrow-right"></i>LEARN MORE..</a></li>
                                </ul>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <!--end footer-->

        </div>
        <!-- End Page wrapper  -->
    </div>
    <!-- End Wrapper -->

    <!-- Bootstrap JS, Popper.js, and jQuery via CDN -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <!-- Custom JS -->
    <script src="{{url_for('static', filename='jquery-RES.min.js ')}}"></script>
    <!-- Bootstrap tether Core JavaScript -->
    <script src="{{url_for('static', filename='popper.min.js')}}"></script>
    <script src="{{url_for('static', filename='bootstrap-RES.min.js')}}"></script>
    <!-- slimscrollbar scrollbar JavaScript -->
    <!-- <script src="{{url_for('static', filename='jquery.slimscroll.js')}}"></script> -->
    <!--Menu sidebar -->
    <!-- <script src="{{url_for('static', filename='sidebarmenu.js')}}"></script> -->
    <!--stickey kit -->
    <script src="{{url_for('static', filename='sticky-kit.min.js')}}"></script>

    <script src="{{url_for('static', filename='d3.min.js')}}"></script>
    <script src="{{url_for('static', filename='topojson.js')}}"></script>

    <script src="{{url_for('static', filename='owl.carousel.min.js')}}"></script>
    <script src="{{url_for('static', filename='owl.carousel-init.js')}}"></script>

    <!--Custom JavaScript -->
    <script src="{{url_for('static', filename='custom.min.js')}}"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('submitBtn').addEventListener('click', function() {
                const symbolInput = document.getElementById('callinsertintotable');
                if (!symbolInput) {
                    console.error("Symbol input element not found.");
                    return;
                }
                const symbol = symbolInput.value;
                const progressBar = document.getElementById('loadingProgressBar');
                const progressBarInner = progressBar.querySelector('.progress-bar');
                progressBar.style.display = 'block'; // Make sure the progress bar is visible
                progressBarInner.style.width = '0%'; // Reset to 0%
                progressBarInner.setAttribute('aria-valuenow', 0);

                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    progressBarInner.style.width = `${progress}%`;
                    progressBarInner.setAttribute('aria-valuenow', progress);
                    if (progress >= 100) {
                        clearInterval(interval);
                    }
                }, 1000); // Increment every second

                fetch('/insertintotable', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ symbol: symbol }),
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Received data:', data);  // Debugging to see received data
                    progressBarInner.style.width = '100%'; // Complete the progress 
                    setTimeout(() => {
                        progressBar.style.display = 'none'; // Hide the progress bar after a short delay
                        progressBarInner.style.width = '0%'; // Reset progress for the next use
                        progressBarInner.setAttribute('aria-valuenow', 0);
                    }, 500);

                    if (data.error) {
                        alert(data.error);
                        return;
                    }

                    // Update text contains
                    updateTextContent('today-stock-data', `TODAY'S ${data.quote} STOCK DATA`, 'quote');
                    updateTextContent('open-value', data.open, 'open');
                    updateTextContent('high-value', data.high, 'high');
                    updateTextContent('low-value', data.low, 'low');
                    updateTextContent('close-value', data.close, 'close');
                    updateTextContent('adj-close-value', data.adj_close, 'adj_close');
                    updateTextContent('volume-value', data.volume, 'volume');
                    updateTextContent('arima-text', `TOMORROW'S ${data.quote} CLOSING PRICE BY ARIMA`, 'quote');
                    updateTextContent('lstm-text', `TOMORROW'S ${data.quote} CLOSING PRICE BY LSTM`, 'quote');
                    updateTextContent('lr-text', `TOMORROW'S ${data.quote} CLOSING PRICE BY LINEAR REGRESSION`, 'quote');
                    updateTextContent('arima-pred-text', `PREDICTED ${data.quote} PRICE FOR THE NEXT 7 DAYS WITH ARIMA`, 'quote');
                    updateTextContent('lstm-pred-text', `PREDICTED ${data.quote} PRICE FOR THE NEXT 7 DAYS WITH LSTM`, 'quote');
                    updateTextContent('lr-pred-text', `PREDICTED ${data.quote} PRICE FOR THE NEXT 7 DAYS WITH LINEAR REGRESSION`, 'quote');
                    updateTextContent('causal-text', `Granger Causality Matrix OF ${data.quote} STOCK`, 'quote');



                    // Render the Plotly graph
                    Plotly.newPlot('plotly-trend-graph-container', JSON.parse(data.trend_graph_json).data, JSON.parse(data.trend_graph_json).layout);
                    Plotly.newPlot('plotly-arima-graph-container', JSON.parse(data.arima_graph_json).data, JSON.parse(data.arima_graph_json).layout);
                    Plotly.newPlot('plotly-lstm-graph-container', JSON.parse(data.lstm_graph_json).data, JSON.parse(data.lstm_graph_json).layout);
                    Plotly.newPlot('plotly-lr-graph-container', JSON.parse(data.lr_graph_json).data, JSON.parse(data.lr_graph_json).layout);
                    Plotly.newPlot('plotly-sentiment-graph-container', JSON.parse(data.sentiment_graph_json).data, JSON.parse(data.sentiment_graph_json).layout);



                    const causalModelImage = document.getElementById('causal-model-image');
                    if (causalModelImage) {
                        const imagePath = "{{ url_for('static', filename='causal_model.png') }}" + "?t=" + new Date().getTime();
                        console.log("Image path received:", imagePath);
                        causalModelImage.src = imagePath;
                    } else {
                        console.error("Image element with id 'causal-model-image' not found in the DOM");
                        alert("Image element with id 'causal-model-image' not found in the DOM");
                    }


                    
                    // Update news headlines
                    updateNewsHeadlinesTable(data.news_headlines);

                    // Update predictions
                    updateTextContent('arima-pred', data.arima_pred, 'arima_pred');
                    updateTextContent('lstm-pred', data.lstm_pred, 'lstm_pred');
                    updateTextContent('lr-pred', data.lr_pred, 'lr_pred');

                    // Update errors
                    updateTextContent('error-arima', data.error_arima, 'error_arima');
                    updateTextContent('error-lstm', data.error_lstm, 'error_lstm');
                    updateTextContent('error-lr', data.error_lr, 'error_lr');

                    // Update MAEs
                    updateTextContent('mae-arima', data.mae_arima, 'mae_arima');
                    updateTextContent('mae-lstm', data.mae_lstm, 'mae_lstm');
                    updateTextContent('mae-lr', data.mae_lr, 'mae_lr');

                    // Update Twitter polarity
                    updateTextContent('polarity', data.polarity, 'polarity');

                    // Update recommendation
                    updateTextContent('idea-decision', `According to the ML Predictions & Sentiment Analysis of the News, a ${data.idea} in ${data.quote} stock is expected => ${data.decision}`, 'idea-decision');

                    // Update forecasts
                    updateForecastTable('#arima-forecast tbody', data.forecast_set_arima, 'forecast_set_arima');
                    updateForecastTable('#lstm-forecast tbody', data.forecast_set_lstm, 'forecast_set_lstm');
                    updateForecastTable('#lr-forecast tbody', data.forecast_set_lr, 'forecast_set_lr');

                    // Update causal results
                    updateInnerHTML('.granger_causation_matrix', data.granger_results_html, 'granger_results_html');
                    updateInnerHTML('#causal-estimate-regression', `Causal effect estimate (linear regression): ${data.causal_estimate_regression}`, 'causal_estimate_regression')
                    updateInnerHTML('#causal-estimate-regression-p', `Explanation: This estimate suggests that, according to the linear regression method, the treatment (<strong>[RSI]</strong>) has a <strong>${data.causal_estimate_regression_pos_neg}</strong> causal effect on the outcome (<strong>[CLOSE]</strong>). Specifically, a one-unit increase in <strong>[RSI]</strong> is associated with an average <strong>${data.causal_estimate_regression_increase_decrease}</strong> of approximately <strong>${data.causal_estimate_regression}</strong> units in <strong>[CLOSE]</strong>, holding other common causes constant.`, 'causal_estimate_regression')
                    updateInnerHTML('#causal-estimate-iv', `Causal effect estimate (instrumental variable): ${data.causal_estimate_iv}`, 'causal_estimate-iv')
                    updateInnerHTML('#causal-estimate-iv-p', `Explanation: This estimate, derived from the instrumental variable method, indicates that the treatment (<strong>[RSI]</strong>) has a <strong>${data.causal_estimate_iv_pos_neg}</strong> causal effect on the outcome (<strong>[CLOSE]</strong>). Here, a one-unit increase in <strong>[RSI]</strong> is associated with an average <strong>${data.causal_estimate_iv_increase_decrease}</strong> of approximately <strong>${data.causal_estimate_iv}</strong> units in <strong>[CLOSE]</strong>, when using <strong>[VOLUME]</strong> as an instrument.`, 'causal_estimate-iv')

                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
            });

            function updateTextContent(elementId, text, variableName) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = text;
                } else {
                    console.error(`Failed to find element with ID: ${elementId} for variable ${variableName}`);
                }
            }

            function updateInnerHTML(selector, htmlContent, variableName) {
                const element = document.querySelector(selector);
                if (element) {
                    element.innerHTML = htmlContent;
                } else {
                    console.error(`Failed to find element with selector: ${selector} for variable ${variableName}`);
                }
            }

            function updateNewsHeadlinesTable(headlines) {
                const tableBody = document.getElementById('news-headlines');
                if (!tableBody) {
                    console.error("No table body found for news headlines.");
                    return;
                }

                if (!headlines || !Array.isArray(headlines) || headlines.length === 0) {
                    console.error("Invalid or empty news headlines data:", headlines);
                    tableBody.innerHTML = '<tr><td colspan="5">No news headlines available</td></tr>'; // Show a message in the table if no data
                    return;
                }

                let rowsHtml = '';
                headlines.forEach((headline, index) => {
                    if (index < 10) {
                        rowsHtml += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${headline}</td>
                                <td><span></span></td>
                                <td><span></span></td>
                                <td><span class="badge badge-success"></span></td>
                            </tr>`;
                    }
                });

                tableBody.innerHTML = rowsHtml;
            }

            function updateForecastTable(selector, forecastSet, variableName) {
                const tableBody = document.querySelector(selector);
                if (!tableBody) {
                    console.error(`No table body found for selector: ${selector} for variable ${variableName}`);
                    return;
                }

                if (!forecastSet || !Array.isArray(forecastSet) || forecastSet.length === 0) {
                    console.error(`Invalid or empty forecast data for variable ${variableName}:`, forecastSet);
                    tableBody.innerHTML = '<tr><td colspan="2">No data available</td></tr>'; // Show a message in the table if no data
                    return;
                }

                let rowsHtml = '';
                forecastSet.forEach((price, index) => {
                    rowsHtml += `<tr><td>${index + 1}</td><td>${price}</td></tr>`;
                });

                tableBody.innerHTML = rowsHtml;
            }

            function formatCausalResults(causalResults) {
                if (!causalResults) {
                    return '<pre>No causal results available</pre>';
                }

                let resultHtml = '<table class="table table-bordered"><tbody>';
                for (const [key, value] of Object.entries(causalResults)) {
                    resultHtml += `<tr><th colspan="2">${key}</th></tr>`;
                    for (const [subKey, subValue] of Object.entries(value)) {
                        resultHtml += `<tr><td>${subKey}</td><td>${JSON.stringify(subValue)}</td></tr>`;
                    }
                }
                resultHtml += '</tbody></table>';

                return resultHtml;
            }
        });

    </script>
    
</body>

</html>

